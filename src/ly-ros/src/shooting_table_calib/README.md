# 射表标定系统使用说明

## 概述
射表标定系统（ShootingTableCalibration）是基于AutoAim系统开发的射击精度标定工具，用于收集不同距离和高度下的射击补偿数据。

## 编译
```bash
cd build
cmake .. && make
```

## 运行
```bash
cd bin
./ShootingTableCalibration
```

## 操作流程

### 1. 系统初始化
- 启动程序后，系统会自动初始化相机、串口等硬件设备
- 等待检测到装甲板目标

### 2. 手动瞄准目标
- 按下 `t` 键触发单次瞄准检测
- 系统会尝试检测并锁定一个装甲板目标
- 成功锁定后显示"TARGET LOCKED"状态和目标距离信息

### 3. 开始射击
- 目标锁定后，按下 `空格键` 开始射击序列
- 系统会自动射击3秒钟
- 射击期间屏幕显示"SHOOTING"状态

### 4. 微调瞄准
- 射击结束后，根据弹着点位置手动微调：
  - `w` - 增加pitch角（向上）
  - `s` - 减少pitch角（向下）
  - `a` - 减少yaw角（向左）
  - `d` - 增加yaw角（向右）
- 每次调整步长为0.1度

### 5. 确认中心命中
- 当观察到弹着点击中装甲板中心时，按下 `c` 键
- 系统会保存当前的射表数据

### 6. 重复流程
- 移动到不同距离或高度的目标
- 重复步骤2-5（按't'键重新瞄准新目标）

### 7. 退出程序
- 按下 `q` 键退出程序

## 控制键说明
| 按键 | 功能 |
|------|------|
| `t` | 触发单次瞄准检测 |
| `空格键` | 开始射击序列（需要先锁定目标） |
| `s` | 向下调pitch |
| `w` | 向上调pitch |
| `a` | 向左调yaw |
| `d` | 向右调yaw |
| `c` | 确认命中中心，保存记录 |
| `r` | 重置调整参数为零 |
| `q` | 退出程序 |

## 输出数据
射表数据会保存到 `../record/shooting_table_[timestamp].csv` 文件中，包含以下字段：

- `timestamp`: 时间戳
- `z_height`: 目标z轴高度（米）
- `horizontal_distance`: 水平距离（米）
- `relative_yaw`: 相对yaw补偿角度（度）
- `relative_pitch`: 相对pitch补偿角度（度）
- `target_x/y/z`: 目标世界坐标（米）
- `absolute_yaw/pitch`: 射击时IMU的绝对角度（度）

## 注意事项

1. **安全第一**：确保射击环境安全，有适当的靶场设置
2. **目标稳定**：确保装甲板目标稳定固定
3. **观察准确**：仔细观察弹着点，确保准确判断是否命中中心
4. **数据完整**：尽量在不同距离（如1-8米）和不同高度收集数据
5. **环境一致**：在相同的光照和环境条件下进行标定

## 故障排除

### 无法检测到目标
- 检查相机是否正常工作
- 调整光照条件
- 确保装甲板在相机视野内

### 射击无响应
- 检查串口连接
- 确认射击权限已启用
- 检查弹药供给

### 数据文件无法创建
- 检查 `../record/` 目录是否存在
- 确认程序有写入权限

## 数据分析
生成的CSV文件可以用于：
- 分析不同距离下的补偿规律
- 建立射击补偿查找表
- 训练神经网络预测模型
- 优化射击算法参数
